@inherits Umbraco.Web.Macros.PartialViewMacroPage
@using uForum;

@{
    var project = Model.Content;
    
    var owner = Members.GetById(Model.Content.GetPropertyValue<int>("owner"));
    
    var files = uWiki.Businesslogic.WikiFile.CurrentFiles(project.Id);
    var screenshots = files.Where(x => x.FileType == "screenshot");
    var packages = files.Where(x => x.FileType == "package");
    var docs = files.Where(x => x.FileType == "docs");
    var source = files.Where(x => x.FileType == "source");
    
    var currentRelease = new uWiki.Businesslogic.WikiFile( project.GetPropertyValue<int>("file") );    
    
    var karma = our.Utils.GetProjectTotalKarma(project.Id);
    var downloads = our.Utils.GetProjectTotalDownloadCount(project.Id);

    var sourceUrl = project.GetPropertyValue("sourceUrl");
    var websiteUrl = project.GetPropertyValue("websiteUrl");
    var demoUrl = project.GetPropertyValue("demoUrl");
    var licenseUrl = project.GetPropertyValue("licenseUrl");
}

<section class="package-detail">
                <div class="container">
                    <div class="row">

                        <div class="col-md-7">
                            <div class="package-detail-content">

                                <div class="vote"><i class="icon-Hearts"></i><span>@karma votes</span></div>

                                <div class="package-detail-description">
                                    <h1>@project.Name</h1>

                                    <img class="hero-image" src="https://s3.amazonaws.com/f.cl.ly/items/3q1w1O3m3r0L202i1H0o/Untitled-2.gif" alt="">

                                    @project.GetPropertyValue("description");

                                </div>

                                @if(screenshots.Any()){
                                <div class="package-detail-screenshots">
                                    <h3>Screenshots</h3>

                                    <div class="row">

                                        @foreach(var image in screenshots){
                                            <div class="col-xs-4 col-md-3">
                                                <a href="#">
                                                    <img src="@image.Path" alt="">
                                                </a>
                                            </div>
                                        }

                                    </div>
                                </div>
                                }

                                <div  class="package-misc">
									<ul class="tabs">
										<li class="tab-link current" data-tab="tab-package">Package Files</li>
										<li class="tab-link" data-tab="tab-docs">Documentation</li>
                                        @if(source.Any()){
										<li class="tab-link" data-tab="tab-source">Source code</li>
                                        }
                                        <li class="tab-link" data-tab="tab-archive">Archived Files</li>
									</ul>

									<div id="tab-package" class="tab-content current">
										<h3>Package files</h3>
										
										<ul class="search-all-results">
											
                                            @foreach(var release in packages.Where(x => x.Current && !x.Archived).OrderByDescending(x => x.Version.Version)){
                                            <li>
												<a href="/FileDownload?id=@release.Id">
													<div class="type-icon">
														<i class="icon-Box"></i>
													</div>

													<div class="type-context">
														<div class="type-name">
															 @release.Name
														</div>
														<div class="type-description">
															uploaded @release.CreateDate.ToShortDateString() by @owner.Name<br>
															<span>For Umbraco: @string.Join(", ", release.Versions.Select(x => x.Name)) <br /> .NET Version:  &nbsp; Full Trust Required</span>
														</div>
													</div>
												</a>
											</li>
											}
										</ul>
									</div>

                                    <div id="tab-archive" class="tab-content">
										<h3>Archived files</h3>
										
										<ul class="search-all-results">
											
                                            @foreach(var release in packages.Where(x => x.Archived).OrderByDescending(x => x.Version.Version)){
                                            <li>
												<a href="/FileDownload?id=@release.Id">
													<div class="type-icon">
														<i class="icon-Box"></i>
													</div>

													<div class="type-context">
														<div class="type-name">
															 @release.Name
														</div>
														<div class="type-description">
															uploaded @release.CreateDate.ToShortDateString() by @owner.Name<br>
															<span>For Umbraco: @string.Join(", ", release.Versions.Select(x => x.Name)) <br /> .NET Version:  &nbsp; Full Trust Required</span>
														</div>
													</div>
												</a>
											</li>
											}
										</ul>
									</div>

                                    <div id="tab-docs" class="tab-content">
										<h3>Documentation</h3>
										
										<ul class="search-all-results">
											
                                            @foreach(var release in docs.Where(x => !x.Archived).OrderByDescending(x => x.Version.Version)){
                                            <li>
												<a href="/FileDownload?id=@release.Id">
													<div class="type-icon">
														<i class="icon-Box"></i>
													</div>

													<div class="type-context">
														<div class="type-name">
															 @release.Name
														</div>
														<div class="type-description">
															uploaded @release.CreateDate.ToShortDateString() by @owner.Name<br>
														</div>
													</div>
												</a>
											</li>
											}
										</ul>
									</div>

                                    <div id="tab-source" class="tab-content">
										<h3>Source code</h3>
										
										<ul class="search-all-results">
											
                                            @foreach(var release in source.Where(x => !x.Archived).OrderByDescending(x => x.Version.Version)){
                                            <li>
												<a href="/FileDownload?id=@release.Id">
													<div class="type-icon">
														<i class="icon-Box"></i>
													</div>

													<div class="type-context">
														<div class="type-name">
															 @release.Name
														</div>
														<div class="type-description">
															uploaded @release.CreateDate.ToShortDateString() by @owner.Name<br>
														</div>
													</div>
												</a>
											</li>
											}
										</ul>
									</div>
								
									</div>
                                    

                                    
									<div class="package-forum-activity hidden-xs">
										<h3>Forum Activity</h3>
										<a href="forum-thread.html" class="forum-thread">
											<div class="row">
												<div class="col-xs-2 col-md-2">
													<img src="https://s3.amazonaws.com/uifaces/faces/twitter/kfriedson/128.jpg" alt="">
												</div>
												<div class="col-xs-8 col-md-8">
													<div class="forum-thread-text">
														<h3>Allow user to change site design</h3>
														<p>Reply by Dennis Aaen 7 minutes ago</p>
													</div>
												</div>

											</div>
										</a>

										<a href="forum-thread.html" class="forum-thread">
											<div class="row">
												<div class="col-xs-2 col-md-2">
													<img src="https://s3.amazonaws.com/uifaces/faces/twitter/kfriedson/128.jpg" alt="">
												</div>
												<div class="col-xs-8 col-md-8">
													<div class="forum-thread-text">
														<h3>Allow user to change site design</h3>
														<p>Reply by Dennis Aaen 7 minutes ago</p>
													</div>
												</div>

											</div>
										</a>

										<a href="forum-thread.html" class="forum-thread">
											<div class="row">
												<div class="col-xs-2 col-md-2">
													<img src="https://s3.amazonaws.com/uifaces/faces/twitter/kfriedson/128.jpg" alt="">
												</div>
												<div class="col-xs-8 col-md-8">
													<div class="forum-thread-text">
														<h3>Allow user to change site design</h3>
														<p>Reply by Dennis Aaen 7 minutes ago</p>
													</div>
												</div>

											</div>
										</a>

									</div>

                            </div>
                        </div>

                        <div class="col-md-4 col-md-offset-1">
                            <div class="package-detail-sidebar">

                                @if(currentRelease != null){
                                    <a href="/FileDownload?id=@currentRelease.Id" class="button green">Download package</a>
                                }

                                <div class="package-creator">
                                    <h3>Project owner</h3>

                                    <div class="row">
                                        <div class="col-xs-12">
                                            <div class="package-creator-information">
                                                <img src="@owner.Avatar()" alt="">
                                                <div class="text">
                                                    <h3>
                                                        <a href="#">@owner.Name
                                                        </a>
                                                    </h3>
                                                    <small>@owner.Name.Split(' ').First() has @owner.Karma() karma points</small>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>


                                <div class="package-compatibility">
                                    <h3>Project Compatibility</h3>
                                    
                                    <div class="package-compatibility-versions" data-id="@project.Id" data-file="@currentRelease.Id" >Loading...</div>

                                </div>

                                <div class="package-compatibility-information">
                                    <h3>Project Information</h3>

                                    <ul>
                                        <li>
                                            <span>Project owner:</span> @owner.Name
                                        </li>

                                        <li>
                                            <span>Contributors:</span> Tim Geyssens
                                        </li>
                                        
                                        <li>
                                            <span>Created:</span> @project.CreateDate.ToShortDateString()
                                        </li>

                                        <li>
                                            <span>Is Stable:</span> @project.GetPropertyValue("stable")
                                        </li>
                                        <li>
                                            <span>Current version</span> @project.GetPropertyValue("version")
                                        </li>

                                        <li>
                                            <span>.net Version</span> @project.GetPropertyValue("dotNetVersion")
                                        </li>

                                        <li>
                                            <span>License</span> @project.GetPropertyValue("licenseName")
                                        </li>
                                        <li>
                                            <span>Tags</span>
                                            
                                            @foreach(var tag in Umbraco.TagQuery.GetTagsForProperty(project.Id, "tags")){
                                                <text>@tag.Text </text>
                                            }
                                        </li>
                                        <li>
                                            <span>Downloads:</span> @downloads
                                        </li>
                                    </ul>
                                </div>

                                <div class="package-compatibility-information">
                                    <h3>External resources</h3>

                                    <ul>
                                        <li>
                                            <span>Source code</span>
                                        </li>

                                        <li>
                                            <span>Project website</span>
                                        </li>

                                        <li>
                                            <span>Issue tracker</span>
                                        </li>
                                    </ul>
                                </div>

                            </div>
                        </div>

                    </div>
                </div>
            </section>